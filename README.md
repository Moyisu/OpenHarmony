
# OH端到端安全评估框架代码

## 文档结构
```
├── data_collection.js       # 数据采集模块
├── feature_extraction.js    # 特征提取模块
├── threat_analysis.js       # 威胁分析模块
├── alert_module.js          # 预警模块
├── test_logs.js             # 测试数据
└── README.md                # 项目说明文件
```

**1.** **简介**

本文档详细给出了一个完整的 OpenHarmony端到端安全评估框架代码。该框架由 **数据采集、特征提取、威胁分析、预警**等模块组成，旨在为OpenHarmony系统提供安全评估与威胁检测的能力。框架通过实时收集系统和应用日志，提取特征，分析潜在威胁，并在威胁发生时进行自动预警。

**2.** **数据采集模块**

数据采集模块的主要职责是从OpenHarmony系统或应用中收集运行日志。这些日志将作为后续分析的基础数据。我们通过使用 **HiLog** API 来获取日志，并将其保存到文件中。

**关键部分：**

- **导入模块**：此模块导入了hilog和fileio，分别用于日志收集和文件操作。日志信息包括：时间戳、日志级别、事件名称和消息内容。

- **日志配置与缓存**：设置了日志文件路径LOG_FILE_PATH和最大日志条目数MAX_LOG_ENTRIES，并初始化一个空的logBuffer用于存储日志条目。日志数据保存为JSON格式，便于后续特征提取和分析。

- **数据收集**：collectLogs(logLevel)函数模拟了从系统收集日志的过程，采用HiLog API来捕获不同级别的日志（如INFO、ERROR）。

- **日志刷新**：当缓冲区中的日志达到指定数量时，flushLogsToFile()函数会将日志写入文件，并清空缓冲区。

- **定时任务**：通过setInterval定时执行日志收集操作。

**3.** **特征提取模块**

特征提取模块从收集到的日志中提取有价值的信息，如日志级别、事件类型、日志长度等。这些特征用于后续的威胁分析。

**关键部分：**

- **日志解析**：读取保存的JSON格式日志文件。
- **特征提取**：通过简单的文本处理和NLP技术，提取每条日志的关键特征（如事件类型、组件名、消息长度等）。
- **结果保存**：提取的特征被保存为JSON文件，便于后续分析。

**4.** **威胁分析模块**

威胁分析模块基于提取的日志特征进行安全威胁分析。通过 **规则匹配** 和 **异常检测**，检测潜在的安全威胁（如SQL注入、权限提升等）。

**关键部分：**

- **规则匹配**：基于日志内容匹配特定的关键字，如 unauthorized 或 access denied，以识别潜在威胁。
- **异常检测**：检测日志中的异常模式，如频繁的错误日志，基于Z分数算法等方法来评估。
- **威胁评分**：为每个潜在威胁分配评分，以便进行后续的告警处理。

**5.** **预警模块**

预警模块根据威胁分析的结果触发告警，并执行适当的响应措施。告警方式包括本地日志记录、推送通知等。

**关键部分：**

- **告警生成**：通过威胁分析模块产生的威胁事件触发告警。
- **响应措施**：对于高危事件，可以执行自动化的防御措施，如关闭高危服务等。

**6.** **模块协作**

通过前述模块，整个框架协同工作，确保 **OpenHarmony** 系统能够进行实时安全评估：

- **数据采集模块** 持续收集日志数据。
- **特征提取模块** 从收集到的日志中提取有用特征。
- **威胁分析模块** 基于提取的特征分析潜在威胁。
- **预警模块** 在检测到威胁时触发告警，并执行自动化响应。

整个流程确保框架能够持续监控系统日志，分析潜在安全威胁，并提供即时反馈和自动防御措施。

**7.** **测试数据示例**

该模块是模拟正常和异常日志数据，供数据采集模块使用。正常日志模拟正常操作，异常日志模拟攻击行为（如SQL注入、权限提升等）。完整的测试数据详见链接https://github.com/Moyisu/OpenHarmony/blob/main/test_logs.json
